resources:
  containers:
    - container: rust-builder
      image: rust:1.36-buster

trigger:
  branches:
    include: ["*"]
  tags:
    include: ["*"]

jobs:
  - job: build

    pool:
      vmImage: "ubuntu-16.04"
    container: rust-builder

    steps:
      - script: ./.ci/build.sh
        displayName: "Build package"

      - task: CopyFiles@2
        displayName: Copy release package
        inputs:
          sourceFolder: "$(Build.SourcesDirectory)/target/x86_64-unknown-linux-musl/release"
          contents: ecli.tar.xz
          targetFolder: "$(Build.ArtifactStagingDirectory)/"

      - task: PublishBuildArtifacts@1
        inputs:
          artifactName: ecli.tar.xz
        displayName: "Upload artifacts"
